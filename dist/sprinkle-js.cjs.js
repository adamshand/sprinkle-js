"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const g=t=>typeof t=="string"?document.querySelector(t):t,j=(t,e,n=[])=>{Object.entries(e).forEach(([c,i])=>{if(typeof i=="object"){j(t,i,[...n,c]);return}let s=t;if(n.forEach(r=>{s=s[r]}),n[n.length-1]==="style"&&c.startsWith("--")){s.setProperty(c,i);return}if(c==="className"&&t instanceof SVGElement){s.setAttribute("class",i.toString());return}if(n.length===0&&c.startsWith("data-")){t.setAttribute(c,i);return}s[c]=i})},F=(t,e)=>[...Array(t).keys()].map(()=>Array(e).fill(0)),H=(t=[],e=[],n=(o,c)=>o===c)=>{var r,a,f,u,d,b;const o=F(t.length+1,e.length+1);for(let l=0;l<t.length+1;l+=1)o[l][0]=l;for(let l=0;l<e.length+1;l+=1)o[0][l]=l;for(let l=0;l<t.length;l+=1)for(let E=0;E<e.length;E+=1)if(n(t[l],e[E]))o[l+1][E+1]=o[l][E];else{const _=Math.min(o[l+1][E],o[l][E+1])+1;o[l+1][E+1]=_}const c=[];let i=t.length,s=e.length;for(;i>0&&s>0;)n(t[i-1],e[s-1])?(c.unshift({type:"=",value:t[i-1],skip:!1}),s-=1,i-=1):o[i-1][s]<o[i][s-1]?(c.unshift({type:"-",value:t[i-1],skip:!1}),i-=1):(c.unshift({type:"+",value:e[s-1],skip:!1}),s-=1);return i>0?c.unshift(...((f=(a=(r=t==null?void 0:t.slice)==null?void 0:r.call(t,0,i))==null?void 0:a.map)==null?void 0:f.call(a,l=>({type:"-",value:l,skip:!1})))||[]):s>0&&c.unshift(...((b=(d=(u=e==null?void 0:e.slice)==null?void 0:u.call(e,0,s))==null?void 0:d.map)==null?void 0:b.call(d,l=>({type:"+",value:l,skip:!1})))||[]),c},S=(t,e,n=0)=>t.find((o,c,...i)=>c>n&&e(o,c,...i)),T=t=>Object.prototype.toString.call(t).slice(8,-1),P=t=>{const e=document.createElement("template");return Object.assign(e,{innerHTML:t}),e.content},U=(t,e)=>t.getAttribute(e),p=t=>t instanceof Element?U(t,"key"):t.textContent;let y=[];const k=Symbol("is-reactive"),w=Symbol("memo");let C=null;const L=t=>{[...t].forEach(e=>{if(!e.toRun)return;const n=e.execute();n&&(e.cleanup=n)})},$=t=>{C=new Set;try{t()}finally{const e=new Set(C);C=null,L(e)}},D=(t,e,n)=>{let o=n.get(t);o||(o=new Set,n.set(t,o)),o.add(e),e.dependencies.add(o)},J=(t,e)=>{const n=t.get(e);if(!!n){if(C!==null){n.forEach(o=>C.add(o));return}L(n)}},W=(t,e)=>{if(t[k])return t;if(typeof t!="object")throw new Error("It's not possible to create a variable from a primitive value...you can use createRef");Object.keys(t||{}).forEach(i=>{const s=i;!!t[s]&&typeof t[s]=="object"&&(T(t[s])==="Object"||Array.isArray(t[s]))&&(t[s]=v(t[s],e==null?void 0:e[s]))});const o=new Map;return new Proxy(t,{get:(...i)=>{if(i[1]===k)return!0;const s=y[y.length-1];return s&&D(i[1],s,o),Reflect.get(...i)},set:(i,s,r)=>{var l;if(i[w]===!1&&s!==w)return!0;const a=s,f=(l=e==null?void 0:e[a])!=null?l:Object.is;let u=r;!!r&&typeof r=="object"&&(T(r)==="Object"||Array.isArray(r))&&!r[k]&&(u=v(r,f));const d=f(i[a],r),b=Reflect.set(i,s,u);return d||J(o,s),b}})},B=(t,e,n=":root")=>{const o=v(t,e);let c=g(n);return c||(console.warn("Impossible to find the right html element, attaching the variables to the root."),c=document.querySelector(":root")),h(()=>{Object.keys(o).forEach(s=>{var r;c.style.setProperty(`--${s}`,(r=o[s])==null?void 0:r.toString())})}),o},G=(t,e)=>{const n={value:t(),[w]:!1},o=v(n,e?{value:e}:void 0);return h(()=>{o[w]=!0,o.value=t(),o[w]=!1}),o},Q=(t,e,n,o=window.localStorage)=>{if(typeof e!="object")throw new Error("It's not possible to create a variable from a primitive value...you can use createRef");let c=null;try{const s=o.getItem(t);s?c=JSON.parse(s):o.setItem(t,JSON.stringify(e))}catch{throw new Error("The specified key is associated with a non Object-like element")}const i=v(c!=null?c:e,n);return h(()=>{o.setItem(t,JSON.stringify(i))}),window.addEventListener("storage",s=>{if(s.storageArea===o&&s.key===t)try{if(s.newValue){const r=JSON.parse(s.newValue);Object.keys(r).forEach(f=>{i[f]=r[f]})}}catch{console.warn("The storage was modified but the resulting object is not parsable...the variable was not updated.")}}),i},Y=(t,e)=>v({value:t},e?{value:e}:void 0),m=t=>{t.owned.forEach(e=>{e.toRun=!1,m(e)}),t.dependencies.forEach(e=>{e.delete(t)}),t.dependencies.clear()},z=t=>{const e=()=>{var i,s,r;if(!n.toRun)return;(r=(s=(i=n==null?void 0:n.owner)==null?void 0:i.owned)==null?void 0:s.push)==null||r.call(s,n),n.cleanup&&typeof n.cleanup=="function"&&n.cleanup(),m(n),y.push(n);let c;try{c=t()}finally{y.pop()}return c},n={execute:e,dependencies:new Set,owned:[],owner:y[y.length-1],toRun:!0},o=e();o&&(n.cleanup=o)},A={createVariable:W,createEffect:z,createComputed:G};let x={...A};const v=(t,e)=>x.createVariable(t,e),h=t=>x.createEffect(t),X=(t,e)=>x.createComputed(t,e),Z=(t=A)=>(Object.keys(t).forEach(e=>{x[e]=t[e]}),()=>{x=A}),K=t=>{const e=y;y=[];const n=t();return y=e,n},q=(t,e)=>{const n=g(t);return h(()=>{n&&(n.textContent=e(n))}),n},tt=(t,e)=>{const n=g(t);return h(()=>{n&&(n.innerHTML=e(n))}),n},et=(t,e,n)=>{const o=g(t);return h(()=>{o&&(n(o)?o.classList.add(e):o.classList.remove(e))}),o},nt=(t,e)=>{const n=g(t);return h(()=>{if(n){const o=e(n);Object.keys(o||{}).forEach(i=>{o[i]?n.classList.add(i):n.classList.remove(i)})}}),n},st=(t,e)=>{const n=g(t);return h(()=>{n&&(n.value=e(n))}),n},R=(t,e)=>{const n=g(t);return h(()=>j(n,e(n))),n},ot=(t,e)=>{const n=g(t);if(!!n)return R(n,()=>({style:e(n)})),n},I=(t,e,n)=>{var o,c,i,s,r;if(t instanceof Text){let a=(o=t.textContent)!=null?o:"";const f=/\{\{fn:(?<index>\d+)\}\}/g;let u;for(;u=f.exec((c=t.textContent)!=null?c:"");){if(!((i=u==null?void 0:u.groups)!=null&&i.index))continue;const d=e[+u.groups.index]();a=a.replace(u[0],d)}t.textContent=a}else if(t instanceof HTMLElement){const a=t.tagName.match(/to-replace-(?<index>\d+)/i);((s=a==null?void 0:a.groups)==null?void 0:s.index)!=null&&t.replaceWith(n[+a.groups.index])}for(let a=0;a<t.childNodes.length;a+=1){const f=t.childNodes[a];I(f,e,n)}if(t instanceof Element&&t.attributes)for(let a=0;a<t.attributes.length;a+=1){const f=t.attributes[a],[u,d]=f.name.split(":");if(u==="on"&&d){const b=f.value.match(/\{\{fn:(?<index>\d+)\}\}/);((r=b==null?void 0:b.groups)==null?void 0:r.index)!=null&&(t.addEventListener(d,e[+b.groups.index]),t.removeAttribute(f.name),t.listeners||(t.listeners=new Map),t.listeners.has(d)||t.listeners.set(d,new Set),t.listeners.get(d).add(e[+b.groups.index]))}}},M=(t,e,n,o)=>{if(o==null)return t;if(typeof o=="function")t+=`{{fn:${e.length}}}`,e.push(o);else if(o[N])t+=`<to-replace-${n.length}></to-replace-${n.length}>`,n.push(o);else if(Array.isArray(o))for(let c=0;c<o.length;c+=1){const i=o[c];t=M(t,e,n,i)}else t+=o;return t},N=Symbol("from_h"),it=(t,...e)=>{let n="";const o=[],c=[];for(let s=0;s<t.length;s+=1)n+=t[s],n=M(n,o,c,e[s]);const i=P(n);for(let s=0;s<i.children.length;s+=1){const r=i.children[s];I(r,o,c)}return o.forEach(s=>s()),i[N]=!0,i},O=(t,e)=>{var n,o;(n=e.listeners)==null||n.forEach((c,i)=>{c.forEach(s=>{console.log("removing",s()),e.removeEventListener(i,s)})}),(o=t.listeners)==null||o.forEach((c,i)=>{c.forEach(s=>{console.log("adding",s()),e.addEventListener(i,s)})})},ct=(t,e,n)=>{if(t.children.length===0){const s=Array.from(e);t.append(...s),s.forEach(r=>n(r));return}const o=H(Array.from(t.childNodes),Array.from(e),(s,r)=>p(s)!=null&&p(r)!=null?p(s)===p(r):s===r);let c=o.find(s=>s.type==="="),i=0;o.forEach(s=>{if(s.type==="+"){const r=S(o,a=>a.type==="-"&&p(a.value)===p(s.value),i);if(r&&(O(s.value,r.value),s.value=r.value,r.skip=!0),!c){t.append(s.value),n(s.value),i+=1;return}c.value.before(s.value),n(s.value)}else if(s.type==="-"){if(s.skip){i+=1;return}t.removeChild(s.value);const r=S(o,a=>a.type==="+"&&p(a.value)===p(s.value),i);r&&(O(r.value,s.value),r.value=s.value)}else O(Array.from(e).find(r=>p(r)===p(s.value)),s.value),c=S(o,r=>r.type==="=",i),n(s.value,!1);i+=1})},V=(t,e,n)=>{const o=g(t);return h(()=>{if(o===null)return;const i=e(o).childNodes,s=new Map;ct(o,i,(a,f=!0)=>{const u=p(a);if(u!=null){const d=a;d.isNew=f,s.set(u,d)}}),typeof n=="function"&&h(()=>{n(o,s)})}),o},rt=(t,e,n)=>(...c)=>(console.warn(`${e}${n?`See more at ${n}`:""}`),t(...c)),at=rt(V,"'bindChildrens' is deprecated: please use 'bindChildren' instead.",new URL("https://github.com/paoloricciuti/sprinkle-js/issues/3"));exports.batch=$;exports.bindChildren=V;exports.bindChildrens=at;exports.bindClass=et;exports.bindClasses=nt;exports.bindDom=R;exports.bindInnerHTML=tt;exports.bindInputValue=st;exports.bindStyle=ot;exports.bindTextContent=q;exports.createComputed=X;exports.createCssVariable=B;exports.createEffect=h;exports.createRef=Y;exports.createStored=Q;exports.createVariable=v;exports.html=it;exports.setup=Z;exports.untrack=K;
