"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const g=t=>typeof t=="string"?document.querySelector(t):t,j=(t,e,n=[])=>{Object.entries(e).forEach(([r,i])=>{if(typeof i=="object"){j(t,i,[...n,r]);return}let o=t;if(n.forEach(a=>{o=o[a]}),n[n.length-1]==="style"&&r.startsWith("--")){o.setProperty(r,i);return}if(r==="className"&&t instanceof SVGElement){o.setAttribute("class",i.toString());return}if(n.length===0&&r.startsWith("data-")){t.setAttribute(r,i);return}o[r]=i})},P=(t,e)=>[...Array(t).keys()].map(()=>Array(e).fill(0)),U=(t=[],e=[],n=(s,r)=>s===r)=>{var a,c,l,f,d,b;const s=P(t.length+1,e.length+1);for(let u=0;u<t.length+1;u+=1)s[u][0]=u;for(let u=0;u<e.length+1;u+=1)s[0][u]=u;for(let u=0;u<t.length;u+=1)for(let E=0;E<e.length;E+=1)if(n(t[u],e[E]))s[u+1][E+1]=s[u][E];else{const H=Math.min(s[u+1][E],s[u][E+1])+1;s[u+1][E+1]=H}const r=[];let i=t.length,o=e.length;for(;i>0&&o>0;)n(t[i-1],e[o-1])?(r.unshift({type:"=",value:t[i-1],skip:!1}),o-=1,i-=1):s[i-1][o]<s[i][o-1]?(r.unshift({type:"-",value:t[i-1],skip:!1}),i-=1):(r.unshift({type:"+",value:e[o-1],skip:!1}),o-=1);return i>0?r.unshift(...((l=(c=(a=t==null?void 0:t.slice)==null?void 0:a.call(t,0,i))==null?void 0:c.map)==null?void 0:l.call(c,u=>({type:"-",value:u,skip:!1})))||[]):o>0&&r.unshift(...((b=(d=(f=e==null?void 0:e.slice)==null?void 0:f.call(e,0,o))==null?void 0:d.map)==null?void 0:b.call(d,u=>({type:"+",value:u,skip:!1})))||[]),r},S=(t,e,n=0)=>t.find((s,r,...i)=>r>n&&e(s,r,...i)),T=t=>Object.prototype.toString.call(t).slice(8,-1),$=t=>{const e=document.createElement("template");return Object.assign(e,{innerHTML:t}),e.content},D=(t,e)=>t.getAttribute(e),p=t=>t instanceof Element?D(t,"key"):`[[textNode:${t.textContent}]]`;let y=[];const k=Symbol("is-reactive"),w=Symbol("memo");let C=null;const L=t=>{[...t].forEach(e=>{if(!e.toRun)return;const n=e.execute();n&&(e.cleanup=n)})},m=t=>{C=new Set;try{t()}finally{const e=new Set(C);C=null,L(e)}},J=(t,e,n)=>{let s=n.get(t);s||(s=new Set,n.set(t,s)),s.add(e),e.dependencies.add(s)},W=(t,e)=>{const n=t.get(e);if(!!n){if(C!==null){n.forEach(s=>C.add(s));return}L(n)}},B=(t,e)=>{if(t[k])return t;if(typeof t!="object")throw new Error("It's not possible to create a variable from a primitive value...you can use createRef");Object.keys(t||{}).forEach(i=>{const o=i;!!t[o]&&typeof t[o]=="object"&&(T(t[o])==="Object"||Array.isArray(t[o]))&&(t[o]=v(t[o],e==null?void 0:e[o]))});const s=new Map;return new Proxy(t,{get:(...i)=>{if(i[1]===k)return!0;const o=y[y.length-1];return o&&J(i[1],o,s),Reflect.get(...i)},set:(i,o,a)=>{var u;if(i[w]===!1&&o!==w)return!0;const c=o,l=(u=e==null?void 0:e[c])!=null?u:Object.is;let f=a;!!a&&typeof a=="object"&&(T(a)==="Object"||Array.isArray(a))&&!a[k]&&(f=v(a,l));const d=l(i[c],a),b=Reflect.set(i,o,f);return d||W(s,o),b}})},G=(t,e,n=":root")=>{const s=v(t,e);let r=g(n);return r||(console.warn("Impossible to find the right html element, attaching the variables to the root."),r=document.querySelector(":root")),h(()=>{Object.keys(s).forEach(o=>{var a;r.style.setProperty(`--${o}`,(a=s[o])==null?void 0:a.toString())})}),s},Q=(t,e)=>{const n={value:t(),[w]:!1},s=v(n,e?{value:e}:void 0);return h(()=>{s[w]=!0,s.value=t(),s[w]=!1}),s},Y=(t,e,n,s=window.localStorage)=>{if(typeof e!="object")throw new Error("It's not possible to create a variable from a primitive value...you can use createRef");let r=null;try{const o=s.getItem(t);o?r=JSON.parse(o):s.setItem(t,JSON.stringify(e))}catch{throw new Error("The specified key is associated with a non Object-like element")}const i=v(r!=null?r:e,n);return h(()=>{s.setItem(t,JSON.stringify(i))}),window.addEventListener("storage",o=>{if(o.storageArea===s&&o.key===t)try{if(o.newValue){const a=JSON.parse(o.newValue);Object.keys(a).forEach(l=>{i[l]=a[l]})}}catch{console.warn("The storage was modified but the resulting object is not parsable...the variable was not updated.")}}),i},z=(t,e)=>v({value:t},e?{value:e}:void 0),I=t=>{t.owned.forEach(e=>{e.toRun=!1,I(e)}),t.dependencies.forEach(e=>{e.delete(t)}),t.dependencies.clear()},X=t=>{const e=()=>{var i,o,a;if(!n.toRun)return;(a=(o=(i=n==null?void 0:n.owner)==null?void 0:i.owned)==null?void 0:o.push)==null||a.call(o,n),n.cleanup&&typeof n.cleanup=="function"&&n.cleanup(),I(n),y.push(n);let r;try{r=t()}finally{y.pop()}return r},n={execute:e,dependencies:new Set,owned:[],owner:y[y.length-1],toRun:!0},s=e();s&&(n.cleanup=s)},A={createVariable:B,createEffect:X,createComputed:Q};let x={...A};const v=(t,e)=>x.createVariable(t,e),h=t=>x.createEffect(t),Z=(t,e)=>x.createComputed(t,e),K=(t=A)=>(Object.keys(t).forEach(e=>{x[e]=t[e]}),()=>{x=A}),q=t=>{const e=y;y=[];const n=t();return y=e,n},tt=(t,e)=>{const n=g(t);return h(()=>{n&&(n.textContent=e(n))}),n},et=(t,e)=>{const n=g(t);return h(()=>{n&&(n.innerHTML=e(n))}),n},nt=(t,e,n)=>{const s=g(t);return h(()=>{s&&(n(s)?s.classList.add(e):s.classList.remove(e))}),s},st=(t,e)=>{const n=g(t);return h(()=>{if(n){const s=e(n);Object.keys(s||{}).forEach(i=>{s[i]?n.classList.add(i):n.classList.remove(i)})}}),n},ot=(t,e)=>{const n=g(t);return h(()=>{n&&(n.value=e(n))}),n},N=(t,e)=>{const n=g(t);return h(()=>j(n,e(n))),n},it=(t,e)=>{const n=g(t);if(!!n)return N(n,()=>({style:e(n)})),n},M=(t,e,n)=>{var s,r,i,o,a;if(t instanceof Text){let c=(s=t.textContent)!=null?s:"";const l=/\{\{fn:(?<index>\d+)\}\}/g;let f;for(;f=l.exec((r=t.textContent)!=null?r:"");){if(!((i=f==null?void 0:f.groups)!=null&&i.index))continue;const d=e[+f.groups.index]();c=c.replace(f[0],d)}t.textContent=c}else if(t instanceof HTMLElement){const c=t.tagName.match(/to-replace-(?<index>\d+)/i);((o=c==null?void 0:c.groups)==null?void 0:o.index)!=null&&t.replaceWith(n[+c.groups.index])}for(let c=0;c<t.childNodes.length;c+=1){const l=t.childNodes[c];M(l,e,n)}if(t instanceof Element&&t.attributes)for(let c=0;c<t.attributes.length;c+=1){const l=t.attributes[c],[f,d]=l.name.split(":");if(f==="on"&&d){const b=l.value.match(/\{\{fn:(?<index>\d+)\}\}/);((a=b==null?void 0:b.groups)==null?void 0:a.index)!=null&&(t.addEventListener(d,e[+b.groups.index]),t.removeAttribute(l.name),t.listeners||(t.listeners=new Map),t.listeners.has(d)||t.listeners.set(d,new Set),t.listeners.get(d).add(e[+b.groups.index]))}}},R=(t,e,n,s)=>{if(s==null)return t;if(typeof s=="function")t+=`{{fn:${e.length}}}`,e.push(s);else if(s[V])t+=`<to-replace-${n.length}></to-replace-${n.length}>`,n.push(s);else if(Array.isArray(s))for(let r=0;r<s.length;r+=1){const i=s[r];t=R(t,e,n,i)}else t+=s;return t},V=Symbol("from_h"),ct=(t,...e)=>{let n="";const s=[],r=[];for(let o=0;o<t.length;o+=1)n+=t[o],n=R(n,s,r,e[o]);const i=$(n);for(let o=0;o<i.children.length;o+=1){const a=i.children[o];M(a,s,r)}return i[V]=!0,i},O=(t,e)=>{var n,s;(n=e.listeners)==null||n.forEach((r,i)=>{r.forEach(o=>{var a;e.removeEventListener(i,o),(a=e.listeners.get(i))==null||a.delete(o)})}),(s=t.listeners)==null||s.forEach((r,i)=>{r.forEach(o=>{var a;e.addEventListener(i,o),(a=e.listeners.get(i))==null||a.add(o)})})},_=(t,e,n)=>{var a;if(((a=t==null?void 0:t.children)==null?void 0:a.length)&&t.children.length===0){const c=Array.from(e);t.append(...c),c.forEach(l=>n(l));return}const s=U(Array.from(t.childNodes),Array.from(e),(c,l)=>p(c)!=null&&p(l)!=null?p(c)===p(l):c===l);let r=s.find(c=>c.type==="="),i=0;const o=[];s.forEach(c=>{if(c.type==="+"){const l=S(s,f=>f.type==="-"&&p(f.value)===p(c.value),i);if(l&&(o.push({new:c.value,old:l.value}),O(c.value,l.value),c.value=l.value,l.skip=!0),!r){t.append(c.value),n(c.value),i+=1;return}r.value.before(c.value),n(c.value)}else if(c.type==="-"){if(c.skip){i+=1;return}t.removeChild(c.value);const l=S(s,f=>f.type==="+"&&p(f.value)===p(c.value),i);l&&(o.push({new:l.value,old:c.value}),O(l.value,c.value),l.value=c.value)}else{const l=Array.from(e).find(f=>p(f)===p(c.value));o.push({new:c.value,old:l}),O(l,c.value),r=S(s,f=>f.type==="=",i),n(c.value,!1)}i+=1}),o.forEach(c=>{_(c.new,c.old.childNodes,n)})},F=(t,e,n)=>{const s=g(t);return h(()=>{if(s===null)return;const i=e(s).childNodes,o=new Map;_(s,i,(c,l=!0)=>{const f=p(c);if(f!=null&&!(c instanceof Text)){const d=c;d.isNew=l,o.set(f,d)}}),typeof n=="function"&&h(()=>{n(s,o)})}),s},rt=(t,e,n)=>(...r)=>(console.warn(`${e}${n?`See more at ${n}`:""}`),t(...r)),at=rt(F,"'bindChildrens' is deprecated: please use 'bindChildren' instead.",new URL("https://github.com/paoloricciuti/sprinkle-js/issues/3"));exports.batch=m;exports.bindChildren=F;exports.bindChildrens=at;exports.bindClass=nt;exports.bindClasses=st;exports.bindDom=N;exports.bindInnerHTML=et;exports.bindInputValue=ot;exports.bindStyle=it;exports.bindTextContent=tt;exports.createComputed=Z;exports.createCssVariable=G;exports.createEffect=h;exports.createRef=z;exports.createStored=Y;exports.createVariable=v;exports.html=ct;exports.setup=K;exports.untrack=q;
