var SprinkleJS=function(f){"use strict";const E=t=>typeof t=="string"?document.querySelector(t):t,L=(t,e,n=[])=>{Object.entries(e).forEach(([o,c])=>{if(typeof c=="object"){L(t,c,[...n,o]);return}let s=t;if(n.forEach(r=>{s=s[r]}),n[n.length-1]==="style"&&o.startsWith("--")){s.setProperty(o,c);return}if(o==="className"&&t instanceof SVGElement){s.setAttribute("class",c.toString());return}if(n.length===0&&o.startsWith("data-")){t.setAttribute(o,c);return}s[o]=c})},F=(t,e)=>[...Array(t).keys()].map(()=>Array(e).fill(0)),H=(t=[],e=[],n=(i,o)=>i===o)=>{var r,a,u,d,h,y;const i=F(t.length+1,e.length+1);for(let l=0;l<t.length+1;l+=1)i[l][0]=l;for(let l=0;l<e.length+1;l+=1)i[0][l]=l;for(let l=0;l<t.length;l+=1)for(let v=0;v<e.length;v+=1)if(n(t[l],e[v]))i[l+1][v+1]=i[l][v];else{const rt=Math.min(i[l+1][v],i[l][v+1])+1;i[l+1][v+1]=rt}const o=[];let c=t.length,s=e.length;for(;c>0&&s>0;)n(t[c-1],e[s-1])?(o.unshift({type:"=",value:t[c-1],skip:!1}),s-=1,c-=1):i[c-1][s]<i[c][s-1]?(o.unshift({type:"-",value:t[c-1],skip:!1}),c-=1):(o.unshift({type:"+",value:e[s-1],skip:!1}),s-=1);return c>0?o.unshift(...((u=(a=(r=t==null?void 0:t.slice)==null?void 0:r.call(t,0,c))==null?void 0:a.map)==null?void 0:u.call(a,l=>({type:"-",value:l,skip:!1})))||[]):s>0&&o.unshift(...((y=(h=(d=e==null?void 0:e.slice)==null?void 0:d.call(e,0,s))==null?void 0:h.map)==null?void 0:y.call(h,l=>({type:"+",value:l,skip:!1})))||[]),o},O=(t,e,n=0)=>t.find((i,o,...c)=>o>n&&e(i,o,...c)),m=t=>Object.prototype.toString.call(t).slice(8,-1),P=t=>{const e=document.createElement("template");return Object.assign(e,{innerHTML:t}),e.content},U=(t,e)=>t.getAttribute(e),p=t=>t instanceof Element?U(t,"key"):t.textContent;let g=[];const A=Symbol("is-reactive"),w=Symbol("memo");let S=null;const R=t=>{[...t].forEach(e=>{if(!e.toRun)return;const n=e.execute();n&&(e.cleanup=n)})},$=t=>{S=new Set;try{t()}finally{const e=new Set(S);S=null,R(e)}},D=(t,e,n)=>{let i=n.get(t);i||(i=new Set,n.set(t,i)),i.add(e),e.dependencies.add(i)},J=(t,e)=>{const n=t.get(e);if(!!n){if(S!==null){n.forEach(i=>S.add(i));return}R(n)}},W=(t,e)=>{if(t[A])return t;if(typeof t!="object")throw new Error("It's not possible to create a variable from a primitive value...you can use createRef");Object.keys(t||{}).forEach(c=>{const s=c;!!t[s]&&typeof t[s]=="object"&&(m(t[s])==="Object"||Array.isArray(t[s]))&&(t[s]=C(t[s],e==null?void 0:e[s]))});const i=new Map;return new Proxy(t,{get:(...c)=>{if(c[1]===A)return!0;const s=g[g.length-1];return s&&D(c[1],s,i),Reflect.get(...c)},set:(c,s,r)=>{var l;if(c[w]===!1&&s!==w)return!0;const a=s,u=(l=e==null?void 0:e[a])!=null?l:Object.is;let d=r;!!r&&typeof r=="object"&&(m(r)==="Object"||Array.isArray(r))&&!r[A]&&(d=C(r,u));const h=u(c[a],r),y=Reflect.set(c,s,d);return h||J(i,s),y}})},B=(t,e,n=":root")=>{const i=C(t,e);let o=E(n);return o||(console.warn("Impossible to find the right html element, attaching the variables to the root."),o=document.querySelector(":root")),b(()=>{Object.keys(i).forEach(s=>{var r;o.style.setProperty(`--${s}`,(r=i[s])==null?void 0:r.toString())})}),i},G=(t,e)=>{const n={value:t(),[w]:!1},i=C(n,e?{value:e}:void 0);return b(()=>{i[w]=!0,i.value=t(),i[w]=!1}),i},Q=(t,e,n,i=window.localStorage)=>{if(typeof e!="object")throw new Error("It's not possible to create a variable from a primitive value...you can use createRef");let o=null;try{const s=i.getItem(t);s?o=JSON.parse(s):i.setItem(t,JSON.stringify(e))}catch{throw new Error("The specified key is associated with a non Object-like element")}const c=C(o!=null?o:e,n);return b(()=>{i.setItem(t,JSON.stringify(c))}),window.addEventListener("storage",s=>{if(s.storageArea===i&&s.key===t)try{if(s.newValue){const r=JSON.parse(s.newValue);Object.keys(r).forEach(u=>{c[u]=r[u]})}}catch{console.warn("The storage was modified but the resulting object is not parsable...the variable was not updated.")}}),c},Y=(t,e)=>C({value:t},e?{value:e}:void 0),I=t=>{t.owned.forEach(e=>{e.toRun=!1,I(e)}),t.dependencies.forEach(e=>{e.delete(t)}),t.dependencies.clear()},T={createVariable:W,createEffect:t=>{const e=()=>{var c,s,r;if(!n.toRun)return;(r=(s=(c=n==null?void 0:n.owner)==null?void 0:c.owned)==null?void 0:s.push)==null||r.call(s,n),n.cleanup&&typeof n.cleanup=="function"&&n.cleanup(),I(n),g.push(n);let o;try{o=t()}finally{g.pop()}return o},n={execute:e,dependencies:new Set,owned:[],owner:g[g.length-1],toRun:!0},i=e();i&&(n.cleanup=i)},createComputed:G};let k={...T};const C=(t,e)=>k.createVariable(t,e),b=t=>k.createEffect(t),z=(t,e)=>k.createComputed(t,e),X=(t=T)=>(Object.keys(t).forEach(e=>{k[e]=t[e]}),()=>{k=T}),Z=t=>{const e=g;g=[];const n=t();return g=e,n},K=(t,e)=>{const n=E(t);return b(()=>{n&&(n.textContent=e(n))}),n},q=(t,e)=>{const n=E(t);return b(()=>{n&&(n.innerHTML=e(n))}),n},tt=(t,e,n)=>{const i=E(t);return b(()=>{i&&(n(i)?i.classList.add(e):i.classList.remove(e))}),i},et=(t,e)=>{const n=E(t);return b(()=>{if(n){const i=e(n);Object.keys(i||{}).forEach(c=>{i[c]?n.classList.add(c):n.classList.remove(c)})}}),n},nt=(t,e)=>{const n=E(t);return b(()=>{n&&(n.value=e(n))}),n},x=(t,e)=>{const n=E(t);return b(()=>L(n,e(n))),n},st=(t,e)=>{const n=E(t);if(!!n)return x(n,()=>({style:e(n)})),n},M=(t,e,n)=>{var i,o,c,s,r;if(t instanceof Text){let a=(i=t.textContent)!=null?i:"";const u=/\{\{fn:(?<index>\d+)\}\}/g;let d;for(;d=u.exec((o=t.textContent)!=null?o:"");){if(!((c=d==null?void 0:d.groups)!=null&&c.index))continue;const h=e[+d.groups.index]();a=a.replace(d[0],h)}t.textContent=a}else if(t instanceof HTMLElement){const a=t.tagName.match(/to-replace-(?<index>\d+)/i);((s=a==null?void 0:a.groups)==null?void 0:s.index)!=null&&t.replaceWith(n[+a.groups.index])}for(let a=0;a<t.childNodes.length;a+=1){const u=t.childNodes[a];M(u,e,n)}if(t instanceof Element&&t.attributes)for(let a=0;a<t.attributes.length;a+=1){const u=t.attributes[a],[d,h]=u.name.split(":");if(d==="on"&&h){const y=u.value.match(/\{\{fn:(?<index>\d+)\}\}/);((r=y==null?void 0:y.groups)==null?void 0:r.index)!=null&&(t.addEventListener(h,e[+y.groups.index]),t.removeAttribute(u.name),t.listeners||(t.listeners=new Map),t.listeners.has(h)||t.listeners.set(h,new Set),t.listeners.get(h).add(e[+y.groups.index]))}}},N=(t,e,n,i)=>{if(i==null)return t;if(typeof i=="function")t+=`{{fn:${e.length}}}`,e.push(i);else if(i[V])t+=`<to-replace-${n.length}></to-replace-${n.length}>`,n.push(i);else if(Array.isArray(i))for(let o=0;o<i.length;o+=1){const c=i[o];t=N(t,e,n,c)}else t+=i;return t},V=Symbol("from_h"),it=(t,...e)=>{let n="";const i=[],o=[];for(let s=0;s<t.length;s+=1)n+=t[s],n=N(n,i,o,e[s]);const c=P(n);for(let s=0;s<c.children.length;s+=1){const r=c.children[s];M(r,i,o)}return i.forEach(s=>s()),c[V]=!0,c},j=(t,e)=>{var n,i;(n=e.listeners)==null||n.forEach((o,c)=>{o.forEach(s=>{console.log("removing",s()),e.removeEventListener(c,s)})}),(i=t.listeners)==null||i.forEach((o,c)=>{o.forEach(s=>{console.log("adding",s()),e.addEventListener(c,s)})})},ct=(t,e,n)=>{if(t.children.length===0){const s=Array.from(e);t.append(...s),s.forEach(r=>n(r));return}const i=H(Array.from(t.childNodes),Array.from(e),(s,r)=>p(s)!=null&&p(r)!=null?p(s)===p(r):s===r);let o=i.find(s=>s.type==="="),c=0;i.forEach(s=>{if(s.type==="+"){const r=O(i,a=>a.type==="-"&&p(a.value)===p(s.value),c);if(r&&(j(s.value,r.value),s.value=r.value,r.skip=!0),!o){t.append(s.value),n(s.value),c+=1;return}o.value.before(s.value),n(s.value)}else if(s.type==="-"){if(s.skip){c+=1;return}t.removeChild(s.value);const r=O(i,a=>a.type==="+"&&p(a.value)===p(s.value),c);r&&(j(r.value,s.value),r.value=s.value)}else j(Array.from(e).find(r=>p(r)===p(s.value)),s.value),o=O(i,r=>r.type==="=",c),n(s.value,!1);c+=1})},_=(t,e,n)=>{const i=E(t);return b(()=>{if(i===null)return;const c=e(i).childNodes,s=new Map;ct(i,c,(a,u=!0)=>{const d=p(a);if(d!=null){const h=a;h.isNew=u,s.set(d,h)}}),typeof n=="function"&&b(()=>{n(i,s)})}),i},ot=((t,e,n)=>(...o)=>(console.warn(`${e}${n?`See more at ${n}`:""}`),t(...o)))(_,"'bindChildrens' is deprecated: please use 'bindChildren' instead.",new URL("https://github.com/paoloricciuti/sprinkle-js/issues/3"));return f.batch=$,f.bindChildren=_,f.bindChildrens=ot,f.bindClass=tt,f.bindClasses=et,f.bindDom=x,f.bindInnerHTML=q,f.bindInputValue=nt,f.bindStyle=st,f.bindTextContent=K,f.createComputed=z,f.createCssVariable=B,f.createEffect=b,f.createRef=Y,f.createStored=Q,f.createVariable=C,f.html=it,f.setup=X,f.untrack=Z,Object.defineProperties(f,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}}),f}({});
