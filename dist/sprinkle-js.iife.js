var SprinkleJS=function(d){"use strict";const E=t=>typeof t=="string"?document.querySelector(t):t,L=(t,e,n=[])=>{Object.entries(e).forEach(([r,c])=>{if(typeof c=="object"){L(t,c,[...n,r]);return}let i=t;if(n.forEach(a=>{i=i[a]}),n[n.length-1]==="style"&&r.startsWith("--")){i.setProperty(r,c);return}if(r==="className"&&t instanceof SVGElement){i.setAttribute("class",c.toString());return}if(n.length===0&&r.startsWith("data-")){t.setAttribute(r,c);return}i[r]=c})},P=(t,e)=>[...Array(t).keys()].map(()=>Array(e).fill(0)),U=(t=[],e=[],n=(s,r)=>s===r)=>{var a,o,l,f,h,y;const s=P(t.length+1,e.length+1);for(let u=0;u<t.length+1;u+=1)s[u][0]=u;for(let u=0;u<e.length+1;u+=1)s[0][u]=u;for(let u=0;u<t.length;u+=1)for(let v=0;v<e.length;v+=1)if(n(t[u],e[v]))s[u+1][v+1]=s[u][v];else{const rt=Math.min(s[u+1][v],s[u][v+1])+1;s[u+1][v+1]=rt}const r=[];let c=t.length,i=e.length;for(;c>0&&i>0;)n(t[c-1],e[i-1])?(r.unshift({type:"=",value:t[c-1],skip:!1}),i-=1,c-=1):s[c-1][i]<s[c][i-1]?(r.unshift({type:"-",value:t[c-1],skip:!1}),c-=1):(r.unshift({type:"+",value:e[i-1],skip:!1}),i-=1);return c>0?r.unshift(...((l=(o=(a=t==null?void 0:t.slice)==null?void 0:a.call(t,0,c))==null?void 0:o.map)==null?void 0:l.call(o,u=>({type:"-",value:u,skip:!1})))||[]):i>0&&r.unshift(...((y=(h=(f=e==null?void 0:e.slice)==null?void 0:f.call(e,0,i))==null?void 0:h.map)==null?void 0:y.call(h,u=>({type:"+",value:u,skip:!1})))||[]),r},O=(t,e,n=0)=>t.find((s,r,...c)=>r>n&&e(s,r,...c)),x=t=>Object.prototype.toString.call(t).slice(8,-1),$=t=>{const e=document.createElement("template");return Object.assign(e,{innerHTML:t}),e.content},D=(t,e)=>t.getAttribute(e),p=t=>t instanceof Element?D(t,"key"):`[[textNode:${t.textContent}]]`;let g=[];const A=Symbol("is-reactive"),C=Symbol("memo");let S=null;const I=t=>{[...t].forEach(e=>{if(!e.toRun)return;const n=e.execute();n&&(e.cleanup=n)})},m=t=>{S=new Set;try{t()}finally{const e=new Set(S);S=null,I(e)}},J=(t,e,n)=>{let s=n.get(t);s||(s=new Set,n.set(t,s)),s.add(e),e.dependencies.add(s)},W=(t,e)=>{const n=t.get(e);if(!!n){if(S!==null){n.forEach(s=>S.add(s));return}I(n)}},B=(t,e)=>{if(t[A])return t;if(typeof t!="object")throw new Error("It's not possible to create a variable from a primitive value...you can use createRef");Object.keys(t||{}).forEach(c=>{const i=c;!!t[i]&&typeof t[i]=="object"&&(x(t[i])==="Object"||Array.isArray(t[i]))&&(t[i]=w(t[i],e==null?void 0:e[i]))});const s=new Map;return new Proxy(t,{get:(...c)=>{if(c[1]===A)return!0;const i=g[g.length-1];return i&&J(c[1],i,s),Reflect.get(...c)},set:(c,i,a)=>{var u;if(c[C]===!1&&i!==C)return!0;const o=i,l=(u=e==null?void 0:e[o])!=null?u:Object.is;let f=a;!!a&&typeof a=="object"&&(x(a)==="Object"||Array.isArray(a))&&!a[A]&&(f=w(a,l));const h=l(c[o],a),y=Reflect.set(c,i,f);return h||W(s,i),y}})},G=(t,e,n=":root")=>{const s=w(t,e);let r=E(n);return r||(console.warn("Impossible to find the right html element, attaching the variables to the root."),r=document.querySelector(":root")),b(()=>{Object.keys(s).forEach(i=>{var a;r.style.setProperty(`--${i}`,(a=s[i])==null?void 0:a.toString())})}),s},Q=(t,e)=>{const n={value:t(),[C]:!1},s=w(n,e?{value:e}:void 0);return b(()=>{s[C]=!0,s.value=t(),s[C]=!1}),s},Y=(t,e,n,s=window.localStorage)=>{if(typeof e!="object")throw new Error("It's not possible to create a variable from a primitive value...you can use createRef");let r=null;try{const i=s.getItem(t);i?r=JSON.parse(i):s.setItem(t,JSON.stringify(e))}catch{throw new Error("The specified key is associated with a non Object-like element")}const c=w(r!=null?r:e,n);return b(()=>{s.setItem(t,JSON.stringify(c))}),window.addEventListener("storage",i=>{if(i.storageArea===s&&i.key===t)try{if(i.newValue){const a=JSON.parse(i.newValue);Object.keys(a).forEach(l=>{c[l]=a[l]})}}catch{console.warn("The storage was modified but the resulting object is not parsable...the variable was not updated.")}}),c},z=(t,e)=>w({value:t},e?{value:e}:void 0),N=t=>{t.owned.forEach(e=>{e.toRun=!1,N(e)}),t.dependencies.forEach(e=>{e.delete(t)}),t.dependencies.clear()},T={createVariable:B,createEffect:t=>{const e=()=>{var c,i,a;if(!n.toRun)return;(a=(i=(c=n==null?void 0:n.owner)==null?void 0:c.owned)==null?void 0:i.push)==null||a.call(i,n),n.cleanup&&typeof n.cleanup=="function"&&n.cleanup(),N(n),g.push(n);let r;try{r=t()}finally{g.pop()}return r},n={execute:e,dependencies:new Set,owned:[],owner:g[g.length-1],toRun:!0},s=e();s&&(n.cleanup=s)},createComputed:Q};let k={...T};const w=(t,e)=>k.createVariable(t,e),b=t=>k.createEffect(t),X=(t,e)=>k.createComputed(t,e),Z=(t=T)=>(Object.keys(t).forEach(e=>{k[e]=t[e]}),()=>{k=T}),K=t=>{const e=g;g=[];const n=t();return g=e,n},q=(t,e)=>{const n=E(t);return b(()=>{n&&(n.textContent=e(n))}),n},tt=(t,e)=>{const n=E(t);return b(()=>{n&&(n.innerHTML=e(n))}),n},et=(t,e,n)=>{const s=E(t);return b(()=>{s&&(n(s)?s.classList.add(e):s.classList.remove(e))}),s},nt=(t,e)=>{const n=E(t);return b(()=>{if(n){const s=e(n);Object.keys(s||{}).forEach(c=>{s[c]?n.classList.add(c):n.classList.remove(c)})}}),n},st=(t,e)=>{const n=E(t);return b(()=>{n&&(n.value=e(n))}),n},M=(t,e)=>{const n=E(t);return b(()=>L(n,e(n))),n},it=(t,e)=>{const n=E(t);if(!!n)return M(n,()=>({style:e(n)})),n},R=(t,e,n)=>{var s,r,c,i,a;if(t instanceof Text){let o=(s=t.textContent)!=null?s:"";const l=/\{\{fn:(?<index>\d+)\}\}/g;let f;for(;f=l.exec((r=t.textContent)!=null?r:"");){if(!((c=f==null?void 0:f.groups)!=null&&c.index))continue;const h=e[+f.groups.index]();o=o.replace(f[0],h)}t.textContent=o}else if(t instanceof HTMLElement){const o=t.tagName.match(/to-replace-(?<index>\d+)/i);((i=o==null?void 0:o.groups)==null?void 0:i.index)!=null&&t.replaceWith(n[+o.groups.index])}for(let o=0;o<t.childNodes.length;o+=1){const l=t.childNodes[o];R(l,e,n)}if(t instanceof Element&&t.attributes)for(let o=0;o<t.attributes.length;o+=1){const l=t.attributes[o],[f,h]=l.name.split(":");if(f==="on"&&h){const y=l.value.match(/\{\{fn:(?<index>\d+)\}\}/);((a=y==null?void 0:y.groups)==null?void 0:a.index)!=null&&(t.addEventListener(h,e[+y.groups.index]),t.removeAttribute(l.name),t.listeners||(t.listeners=new Map),t.listeners.has(h)||t.listeners.set(h,new Set),t.listeners.get(h).add(e[+y.groups.index]))}}},V=(t,e,n,s)=>{if(s==null)return t;if(typeof s=="function")t+=`{{fn:${e.length}}}`,e.push(s);else if(s[_])t+=`<to-replace-${n.length}></to-replace-${n.length}>`,n.push(s);else if(Array.isArray(s))for(let r=0;r<s.length;r+=1){const c=s[r];t=V(t,e,n,c)}else t+=s;return t},_=Symbol("from_h"),ct=(t,...e)=>{let n="";const s=[],r=[];for(let i=0;i<t.length;i+=1)n+=t[i],n=V(n,s,r,e[i]);const c=$(n);for(let i=0;i<c.children.length;i+=1){const a=c.children[i];R(a,s,r)}return c[_]=!0,c},j=(t,e)=>{var n,s;(n=e.listeners)==null||n.forEach((r,c)=>{r.forEach(i=>{var a;e.removeEventListener(c,i),(a=e.listeners.get(c))==null||a.delete(i)})}),(s=t.listeners)==null||s.forEach((r,c)=>{r.forEach(i=>{var a;e.addEventListener(c,i),(a=e.listeners.get(c))==null||a.add(i)})})},F=(t,e,n)=>{var a;if(((a=t==null?void 0:t.children)==null?void 0:a.length)&&t.children.length===0){const o=Array.from(e);t.append(...o),o.forEach(l=>n(l));return}const s=U(Array.from(t.childNodes),Array.from(e),(o,l)=>p(o)!=null&&p(l)!=null?p(o)===p(l):o===l);let r=s.find(o=>o.type==="="),c=0;const i=[];s.forEach(o=>{if(o.type==="+"){const l=O(s,f=>f.type==="-"&&p(f.value)===p(o.value),c);if(l&&(i.push({new:o.value,old:l.value}),j(o.value,l.value),o.value=l.value,l.skip=!0),!r){t.append(o.value),n(o.value),c+=1;return}r.value.before(o.value),n(o.value)}else if(o.type==="-"){if(o.skip){c+=1;return}t.removeChild(o.value);const l=O(s,f=>f.type==="+"&&p(f.value)===p(o.value),c);l&&(i.push({new:l.value,old:o.value}),j(l.value,o.value),l.value=o.value)}else{const l=Array.from(e).find(f=>p(f)===p(o.value));i.push({new:o.value,old:l}),j(l,o.value),r=O(s,f=>f.type==="=",c),n(o.value,!1)}c+=1}),i.forEach(o=>{F(o.new,o.old.childNodes,n)})},H=(t,e,n)=>{const s=E(t);return b(()=>{if(s===null)return;const c=e(s).childNodes,i=new Map;F(s,c,(o,l=!0)=>{const f=p(o);if(f!=null&&!(o instanceof Text)){const h=o;h.isNew=l,i.set(f,h)}}),typeof n=="function"&&b(()=>{n(s,i)})}),s},ot=((t,e,n)=>(...r)=>(console.warn(`${e}${n?`See more at ${n}`:""}`),t(...r)))(H,"'bindChildrens' is deprecated: please use 'bindChildren' instead.",new URL("https://github.com/paoloricciuti/sprinkle-js/issues/3"));return d.batch=m,d.bindChildren=H,d.bindChildrens=ot,d.bindClass=et,d.bindClasses=nt,d.bindDom=M,d.bindInnerHTML=tt,d.bindInputValue=st,d.bindStyle=it,d.bindTextContent=q,d.createComputed=X,d.createCssVariable=G,d.createEffect=b,d.createRef=z,d.createStored=Y,d.createVariable=w,d.html=ct,d.setup=Z,d.untrack=K,Object.defineProperties(d,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}}),d}({});
