(function(f,b){typeof exports=="object"&&typeof module<"u"?b(exports):typeof define=="function"&&define.amd?define(["exports"],b):(f=typeof globalThis<"u"?globalThis:f||self,b(f.SprinkleJS={}))})(this,function(f){"use strict";const b=e=>typeof e=="string"?document.querySelector(e):e,L=(e,t,n=[])=>{Object.entries(t).forEach(([c,o])=>{if(typeof o=="object"){L(e,o,[...n,c]);return}let s=e;if(n.forEach(r=>{s=s[r]}),n[n.length-1]==="style"&&c.startsWith("--")){s.setProperty(c,o);return}if(c==="className"&&e instanceof SVGElement){s.setAttribute("class",o.toString());return}if(n.length===0&&c.startsWith("data-")){e.setAttribute(c,o);return}s[c]=o})},F=(e,t)=>[...Array(e).keys()].map(()=>Array(t).fill(0)),H=(e=[],t=[],n=(i,c)=>i===c)=>{var r,a,u,d,h,E;const i=F(e.length+1,t.length+1);for(let l=0;l<e.length+1;l+=1)i[l][0]=l;for(let l=0;l<t.length+1;l+=1)i[0][l]=l;for(let l=0;l<e.length;l+=1)for(let v=0;v<t.length;v+=1)if(n(e[l],t[v]))i[l+1][v+1]=i[l][v];else{const re=Math.min(i[l+1][v],i[l][v+1])+1;i[l+1][v+1]=re}const c=[];let o=e.length,s=t.length;for(;o>0&&s>0;)n(e[o-1],t[s-1])?(c.unshift({type:"=",value:e[o-1],skip:!1}),s-=1,o-=1):i[o-1][s]<i[o][s-1]?(c.unshift({type:"-",value:e[o-1],skip:!1}),o-=1):(c.unshift({type:"+",value:t[s-1],skip:!1}),s-=1);return o>0?c.unshift(...((u=(a=(r=e==null?void 0:e.slice)==null?void 0:r.call(e,0,o))==null?void 0:a.map)==null?void 0:u.call(a,l=>({type:"-",value:l,skip:!1})))||[]):s>0&&c.unshift(...((E=(h=(d=t==null?void 0:t.slice)==null?void 0:d.call(t,0,s))==null?void 0:h.map)==null?void 0:E.call(h,l=>({type:"+",value:l,skip:!1})))||[]),c},O=(e,t,n=0)=>e.find((i,c,...o)=>c>n&&t(i,c,...o)),m=e=>Object.prototype.toString.call(e).slice(8,-1),P=e=>{const t=document.createElement("template");return Object.assign(t,{innerHTML:e}),t.content},U=(e,t)=>e.getAttribute(t),y=e=>e instanceof Element?U(e,"key"):e.textContent;let g=[];const A=Symbol("is-reactive"),w=Symbol("memo");let S=null;const x=e=>{[...e].forEach(t=>{if(!t.toRun)return;const n=t.execute();n&&(t.cleanup=n)})},$=e=>{S=new Set;try{e()}finally{const t=new Set(S);S=null,x(t)}},D=(e,t,n)=>{let i=n.get(e);i||(i=new Set,n.set(e,i)),i.add(t),t.dependencies.add(i)},J=(e,t)=>{const n=e.get(t);if(!!n){if(S!==null){n.forEach(i=>S.add(i));return}x(n)}},W=(e,t)=>{if(e[A])return e;if(typeof e!="object")throw new Error("It's not possible to create a variable from a primitive value...you can use createRef");Object.keys(e||{}).forEach(o=>{const s=o;!!e[s]&&typeof e[s]=="object"&&(m(e[s])==="Object"||Array.isArray(e[s]))&&(e[s]=C(e[s],t==null?void 0:t[s]))});const i=new Map;return new Proxy(e,{get:(...o)=>{if(o[1]===A)return!0;const s=g[g.length-1];return s&&D(o[1],s,i),Reflect.get(...o)},set:(o,s,r)=>{var l;if(o[w]===!1&&s!==w)return!0;const a=s,u=(l=t==null?void 0:t[a])!=null?l:Object.is;let d=r;!!r&&typeof r=="object"&&(m(r)==="Object"||Array.isArray(r))&&!r[A]&&(d=C(r,u));const h=u(o[a],r),E=Reflect.set(o,s,d);return h||J(i,s),E}})},B=(e,t,n=":root")=>{const i=C(e,t);let c=b(n);return c||(console.warn("Impossible to find the right html element, attaching the variables to the root."),c=document.querySelector(":root")),p(()=>{Object.keys(i).forEach(s=>{var r;c.style.setProperty(`--${s}`,(r=i[s])==null?void 0:r.toString())})}),i},G=(e,t)=>{const n={value:e(),[w]:!1},i=C(n,t?{value:t}:void 0);return p(()=>{i[w]=!0,i.value=e(),i[w]=!1}),i},Q=(e,t,n,i=window.localStorage)=>{if(typeof t!="object")throw new Error("It's not possible to create a variable from a primitive value...you can use createRef");let c=null;try{const s=i.getItem(e);s?c=JSON.parse(s):i.setItem(e,JSON.stringify(t))}catch{throw new Error("The specified key is associated with a non Object-like element")}const o=C(c!=null?c:t,n);return p(()=>{i.setItem(e,JSON.stringify(o))}),window.addEventListener("storage",s=>{if(s.storageArea===i&&s.key===e)try{if(s.newValue){const r=JSON.parse(s.newValue);Object.keys(r).forEach(u=>{o[u]=r[u]})}}catch{console.warn("The storage was modified but the resulting object is not parsable...the variable was not updated.")}}),o},Y=(e,t)=>C({value:e},t?{value:t}:void 0),R=e=>{e.owned.forEach(t=>{t.toRun=!1,R(t)}),e.dependencies.forEach(t=>{t.delete(e)}),e.dependencies.clear()},T={createVariable:W,createEffect:e=>{const t=()=>{var o,s,r;if(!n.toRun)return;(r=(s=(o=n==null?void 0:n.owner)==null?void 0:o.owned)==null?void 0:s.push)==null||r.call(s,n),n.cleanup&&typeof n.cleanup=="function"&&n.cleanup(),R(n),g.push(n);let c;try{c=e()}finally{g.pop()}return c},n={execute:t,dependencies:new Set,owned:[],owner:g[g.length-1],toRun:!0},i=t();i&&(n.cleanup=i)},createComputed:G};let k={...T};const C=(e,t)=>k.createVariable(e,t),p=e=>k.createEffect(e),z=(e,t)=>k.createComputed(e,t),X=(e=T)=>(Object.keys(e).forEach(t=>{k[t]=e[t]}),()=>{k=T}),Z=e=>{const t=g;g=[];const n=e();return g=t,n},K=(e,t)=>{const n=b(e);return p(()=>{n&&(n.textContent=t(n))}),n},q=(e,t)=>{const n=b(e);return p(()=>{n&&(n.innerHTML=t(n))}),n},ee=(e,t,n)=>{const i=b(e);return p(()=>{i&&(n(i)?i.classList.add(t):i.classList.remove(t))}),i},te=(e,t)=>{const n=b(e);return p(()=>{if(n){const i=t(n);Object.keys(i||{}).forEach(o=>{i[o]?n.classList.add(o):n.classList.remove(o)})}}),n},ne=(e,t)=>{const n=b(e);return p(()=>{n&&(n.value=t(n))}),n},I=(e,t)=>{const n=b(e);return p(()=>L(n,t(n))),n},se=(e,t)=>{const n=b(e);if(!!n)return I(n,()=>({style:t(n)})),n},M=(e,t,n)=>{var i,c,o,s,r;if(e instanceof Text){let a=(i=e.textContent)!=null?i:"";const u=/\{\{fn:(?<index>\d+)\}\}/g;let d;for(;d=u.exec((c=e.textContent)!=null?c:"");){if(!((o=d==null?void 0:d.groups)!=null&&o.index))continue;const h=t[+d.groups.index]();a=a.replace(d[0],h)}e.textContent=a}else if(e instanceof HTMLElement){const a=e.tagName.match(/to-replace-(?<index>\d+)/i);((s=a==null?void 0:a.groups)==null?void 0:s.index)!=null&&e.replaceWith(n[+a.groups.index])}for(let a=0;a<e.childNodes.length;a+=1){const u=e.childNodes[a];M(u,t,n)}if(e instanceof Element&&e.attributes)for(let a=0;a<e.attributes.length;a+=1){const u=e.attributes[a],[d,h]=u.name.split(":");if(d==="on"&&h){const E=u.value.match(/\{\{fn:(?<index>\d+)\}\}/);((r=E==null?void 0:E.groups)==null?void 0:r.index)!=null&&(e.addEventListener(h,t[+E.groups.index]),e.removeAttribute(u.name),e.listeners||(e.listeners=new Map),e.listeners.has(h)||e.listeners.set(h,new Set),e.listeners.get(h).add(t[+E.groups.index]))}}},N=(e,t,n,i)=>{if(i==null)return e;if(typeof i=="function")e+=`{{fn:${t.length}}}`,t.push(i);else if(i[V])e+=`<to-replace-${n.length}></to-replace-${n.length}>`,n.push(i);else if(Array.isArray(i))for(let c=0;c<i.length;c+=1){const o=i[c];e=N(e,t,n,o)}else e+=i;return e},V=Symbol("from_h"),ie=(e,...t)=>{let n="";const i=[],c=[];for(let s=0;s<e.length;s+=1)n+=e[s],n=N(n,i,c,t[s]);const o=P(n);for(let s=0;s<o.children.length;s+=1){const r=o.children[s];M(r,i,c)}return i.forEach(s=>s()),o[V]=!0,o},j=(e,t)=>{var n,i;(n=t.listeners)==null||n.forEach((c,o)=>{c.forEach(s=>{console.log("removing",s()),t.removeEventListener(o,s)})}),(i=e.listeners)==null||i.forEach((c,o)=>{c.forEach(s=>{console.log("adding",s()),t.addEventListener(o,s)})})},oe=(e,t,n)=>{if(e.children.length===0){const s=Array.from(t);e.append(...s),s.forEach(r=>n(r));return}const i=H(Array.from(e.childNodes),Array.from(t),(s,r)=>y(s)!=null&&y(r)!=null?y(s)===y(r):s===r);let c=i.find(s=>s.type==="="),o=0;i.forEach(s=>{if(s.type==="+"){const r=O(i,a=>a.type==="-"&&y(a.value)===y(s.value),o);if(r&&(j(s.value,r.value),s.value=r.value,r.skip=!0),!c){e.append(s.value),n(s.value),o+=1;return}c.value.before(s.value),n(s.value)}else if(s.type==="-"){if(s.skip){o+=1;return}e.removeChild(s.value);const r=O(i,a=>a.type==="+"&&y(a.value)===y(s.value),o);r&&(j(r.value,s.value),r.value=s.value)}else j(Array.from(t).find(r=>y(r)===y(s.value)),s.value),c=O(i,r=>r.type==="=",o),n(s.value,!1);o+=1})},_=(e,t,n)=>{const i=b(e);return p(()=>{if(i===null)return;const o=t(i).childNodes,s=new Map;oe(i,o,(a,u=!0)=>{const d=y(a);if(d!=null){const h=a;h.isNew=u,s.set(d,h)}}),typeof n=="function"&&p(()=>{n(i,s)})}),i},ce=((e,t,n)=>(...c)=>(console.warn(`${t}${n?`See more at ${n}`:""}`),e(...c)))(_,"'bindChildrens' is deprecated: please use 'bindChildren' instead.",new URL("https://github.com/paoloricciuti/sprinkle-js/issues/3"));f.batch=$,f.bindChildren=_,f.bindChildrens=ce,f.bindClass=ee,f.bindClasses=te,f.bindDom=I,f.bindInnerHTML=q,f.bindInputValue=ne,f.bindStyle=se,f.bindTextContent=K,f.createComputed=z,f.createCssVariable=B,f.createEffect=p,f.createRef=Y,f.createStored=Q,f.createVariable=C,f.html=ie,f.setup=X,f.untrack=Z,Object.defineProperties(f,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
