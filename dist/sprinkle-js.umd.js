(function(d,p){typeof exports=="object"&&typeof module<"u"?p(exports):typeof define=="function"&&define.amd?define(["exports"],p):(d=typeof globalThis<"u"?globalThis:d||self,p(d.SprinkleJS={}))})(this,function(d){"use strict";const p=t=>typeof t=="string"?document.querySelector(t):t,x=(t,e,n=[])=>{Object.entries(e).forEach(([r,o])=>{if(typeof o=="object"){x(t,o,[...n,r]);return}let i=t;if(n.forEach(a=>{i=i[a]}),n[n.length-1]==="style"&&r.startsWith("--")){i.setProperty(r,o);return}if(r==="className"&&t instanceof SVGElement){i.setAttribute("class",o.toString());return}if(n.length===0&&r.startsWith("data-")){t.setAttribute(r,o);return}i[r]=o})},P=(t,e)=>[...Array(t).keys()].map(()=>Array(e).fill(0)),U=(t=[],e=[],n=(s,r)=>s===r)=>{var a,c,l,f,h,E;const s=P(t.length+1,e.length+1);for(let u=0;u<t.length+1;u+=1)s[u][0]=u;for(let u=0;u<e.length+1;u+=1)s[0][u]=u;for(let u=0;u<t.length;u+=1)for(let v=0;v<e.length;v+=1)if(n(t[u],e[v]))s[u+1][v+1]=s[u][v];else{const rt=Math.min(s[u+1][v],s[u][v+1])+1;s[u+1][v+1]=rt}const r=[];let o=t.length,i=e.length;for(;o>0&&i>0;)n(t[o-1],e[i-1])?(r.unshift({type:"=",value:t[o-1],skip:!1}),i-=1,o-=1):s[o-1][i]<s[o][i-1]?(r.unshift({type:"-",value:t[o-1],skip:!1}),o-=1):(r.unshift({type:"+",value:e[i-1],skip:!1}),i-=1);return o>0?r.unshift(...((l=(c=(a=t==null?void 0:t.slice)==null?void 0:a.call(t,0,o))==null?void 0:c.map)==null?void 0:l.call(c,u=>({type:"-",value:u,skip:!1})))||[]):i>0&&r.unshift(...((E=(h=(f=e==null?void 0:e.slice)==null?void 0:f.call(e,0,i))==null?void 0:h.map)==null?void 0:E.call(h,u=>({type:"+",value:u,skip:!1})))||[]),r},O=(t,e,n=0)=>t.find((s,r,...o)=>r>n&&e(s,r,...o)),L=t=>Object.prototype.toString.call(t).slice(8,-1),$=t=>{const e=document.createElement("template");return Object.assign(e,{innerHTML:t}),e.content},m=(t,e)=>t.getAttribute(e),y=t=>t instanceof Element?m(t,"key"):`[[textNode:${t.textContent}]]`;let g=[];const T=Symbol("is-reactive"),C=Symbol("memo");let S=null;const I=t=>{[...t].forEach(e=>{if(!e.toRun)return;const n=e.execute();n&&(e.cleanup=n)})},D=t=>{S=new Set;try{t()}finally{const e=new Set(S);S=null,I(e)}},J=(t,e,n)=>{let s=n.get(t);s||(s=new Set,n.set(t,s)),s.add(e),e.dependencies.add(s)},W=(t,e)=>{const n=t.get(e);if(!!n){if(S!==null){n.forEach(s=>S.add(s));return}I(n)}},B=(t,e)=>{if(t[T])return t;if(typeof t!="object")throw new Error("It's not possible to create a variable from a primitive value...you can use createRef");Object.keys(t||{}).forEach(o=>{const i=o;!!t[i]&&typeof t[i]=="object"&&(L(t[i])==="Object"||Array.isArray(t[i]))&&(t[i]=w(t[i],e==null?void 0:e[i]))});const s=new Map;return new Proxy(t,{get:(...o)=>{if(o[1]===T)return!0;const i=g[g.length-1];return i&&J(o[1],i,s),Reflect.get(...o)},set:(o,i,a)=>{var u;if(o[C]===!1&&i!==C)return!0;const c=i,l=(u=e==null?void 0:e[c])!=null?u:Object.is;let f=a;!!a&&typeof a=="object"&&(L(a)==="Object"||Array.isArray(a))&&!a[T]&&(f=w(a,l));const h=l(o[c],a),E=Reflect.set(o,i,f);return h||W(s,i),E}})},G=(t,e,n=":root")=>{const s=w(t,e);let r=p(n);return r||(console.warn("Impossible to find the right html element, attaching the variables to the root."),r=document.querySelector(":root")),b(()=>{Object.keys(s).forEach(i=>{var a;r.style.setProperty(`--${i}`,(a=s[i])==null?void 0:a.toString())})}),s},Q=(t,e)=>{const n={value:t(),[C]:!1},s=w(n,e?{value:e}:void 0);return b(()=>{s[C]=!0,s.value=t(),s[C]=!1}),s},Y=(t,e,n,s=window.localStorage)=>{if(typeof e!="object")throw new Error("It's not possible to create a variable from a primitive value...you can use createRef");let r=null;try{const i=s.getItem(t);i?r=JSON.parse(i):s.setItem(t,JSON.stringify(e))}catch{throw new Error("The specified key is associated with a non Object-like element")}const o=w(r!=null?r:e,n);return b(()=>{s.setItem(t,JSON.stringify(o))}),window.addEventListener("storage",i=>{if(i.storageArea===s&&i.key===t)try{if(i.newValue){const a=JSON.parse(i.newValue);Object.keys(a).forEach(l=>{o[l]=a[l]})}}catch{console.warn("The storage was modified but the resulting object is not parsable...the variable was not updated.")}}),o},z=(t,e)=>w({value:t},e?{value:e}:void 0),N=t=>{t.owned.forEach(e=>{e.toRun=!1,N(e)}),t.dependencies.forEach(e=>{e.delete(t)}),t.dependencies.clear()},A={createVariable:B,createEffect:t=>{const e=()=>{var o,i,a;if(!n.toRun)return;(a=(i=(o=n==null?void 0:n.owner)==null?void 0:o.owned)==null?void 0:i.push)==null||a.call(i,n),n.cleanup&&typeof n.cleanup=="function"&&n.cleanup(),N(n),g.push(n);let r;try{r=t()}finally{g.pop()}return r},n={execute:e,dependencies:new Set,owned:[],owner:g[g.length-1],toRun:!0},s=e();s&&(n.cleanup=s)},createComputed:Q};let k={...A};const w=(t,e)=>k.createVariable(t,e),b=t=>k.createEffect(t),X=(t,e)=>k.createComputed(t,e),Z=(t=A)=>(Object.keys(t).forEach(e=>{k[e]=t[e]}),()=>{k=A}),K=t=>{const e=g;g=[];const n=t();return g=e,n},q=(t,e)=>{const n=p(t);return b(()=>{n&&(n.textContent=e(n))}),n},tt=(t,e)=>{const n=p(t);return b(()=>{n&&(n.innerHTML=e(n))}),n},et=(t,e,n)=>{const s=p(t);return b(()=>{s&&(n(s)?s.classList.add(e):s.classList.remove(e))}),s},nt=(t,e)=>{const n=p(t);return b(()=>{if(n){const s=e(n);Object.keys(s||{}).forEach(o=>{s[o]?n.classList.add(o):n.classList.remove(o)})}}),n},st=(t,e)=>{const n=p(t);return b(()=>{n&&(n.value=e(n))}),n},M=(t,e)=>{const n=p(t);return b(()=>x(n,e(n))),n},it=(t,e)=>{const n=p(t);if(!!n)return M(n,()=>({style:e(n)})),n},R=(t,e,n)=>{var s,r,o,i,a;if(t instanceof Text){let c=(s=t.textContent)!=null?s:"";const l=/\{\{fn:(?<index>\d+)\}\}/g;let f;for(;f=l.exec((r=t.textContent)!=null?r:"");){if(!((o=f==null?void 0:f.groups)!=null&&o.index))continue;const h=e[+f.groups.index]();c=c.replace(f[0],h)}t.textContent=c}else if(t instanceof HTMLElement){const c=t.tagName.match(/to-replace-(?<index>\d+)/i);((i=c==null?void 0:c.groups)==null?void 0:i.index)!=null&&t.replaceWith(n[+c.groups.index])}for(let c=0;c<t.childNodes.length;c+=1){const l=t.childNodes[c];R(l,e,n)}if(t instanceof Element&&t.attributes)for(let c=0;c<t.attributes.length;c+=1){const l=t.attributes[c],[f,h]=l.name.split(":");if(f==="on"&&h){const E=l.value.match(/\{\{fn:(?<index>\d+)\}\}/);((a=E==null?void 0:E.groups)==null?void 0:a.index)!=null&&(t.addEventListener(h,e[+E.groups.index]),t.removeAttribute(l.name),t.listeners||(t.listeners=new Map),t.listeners.has(h)||t.listeners.set(h,new Set),t.listeners.get(h).add(e[+E.groups.index]))}}},V=(t,e,n,s)=>{if(s==null)return t;if(typeof s=="function")t+=`{{fn:${e.length}}}`,e.push(s);else if(s[_])t+=`<to-replace-${n.length}></to-replace-${n.length}>`,n.push(s);else if(Array.isArray(s))for(let r=0;r<s.length;r+=1){const o=s[r];t=V(t,e,n,o)}else t+=s;return t},_=Symbol("from_h"),ot=(t,...e)=>{let n="";const s=[],r=[];for(let i=0;i<t.length;i+=1)n+=t[i],n=V(n,s,r,e[i]);const o=$(n);for(let i=0;i<o.children.length;i+=1){const a=o.children[i];R(a,s,r)}return o[_]=!0,o},j=(t,e)=>{var n,s;(n=e.listeners)==null||n.forEach((r,o)=>{r.forEach(i=>{var a;e.removeEventListener(o,i),(a=e.listeners.get(o))==null||a.delete(i)})}),(s=t.listeners)==null||s.forEach((r,o)=>{r.forEach(i=>{var a;e.addEventListener(o,i),(a=e.listeners.get(o))==null||a.add(i)})})},F=(t,e,n)=>{var a;if(((a=t==null?void 0:t.children)==null?void 0:a.length)&&t.children.length===0){const c=Array.from(e);t.append(...c),c.forEach(l=>n(l));return}const s=U(Array.from(t.childNodes),Array.from(e),(c,l)=>y(c)!=null&&y(l)!=null?y(c)===y(l):c===l);let r=s.find(c=>c.type==="="),o=0;const i=[];s.forEach(c=>{if(c.type==="+"){const l=O(s,f=>f.type==="-"&&y(f.value)===y(c.value),o);if(l&&(i.push({new:c.value,old:l.value}),j(c.value,l.value),c.value=l.value,l.skip=!0),!r){t.append(c.value),n(c.value),o+=1;return}r.value.before(c.value),n(c.value)}else if(c.type==="-"){if(c.skip){o+=1;return}t.removeChild(c.value);const l=O(s,f=>f.type==="+"&&y(f.value)===y(c.value),o);l&&(i.push({new:l.value,old:c.value}),j(l.value,c.value),l.value=c.value)}else{const l=Array.from(e).find(f=>y(f)===y(c.value));i.push({new:c.value,old:l}),j(l,c.value),r=O(s,f=>f.type==="=",o),n(c.value,!1)}o+=1}),i.forEach(c=>{F(c.new,c.old.childNodes,n)})},H=(t,e,n)=>{const s=p(t);return b(()=>{if(s===null)return;const o=e(s).childNodes,i=new Map;F(s,o,(c,l=!0)=>{const f=y(c);if(f!=null&&!(c instanceof Text)){const h=c;h.isNew=l,i.set(f,h)}}),typeof n=="function"&&b(()=>{n(s,i)})}),s},ct=((t,e,n)=>(...r)=>(console.warn(`${e}${n?`See more at ${n}`:""}`),t(...r)))(H,"'bindChildrens' is deprecated: please use 'bindChildren' instead.",new URL("https://github.com/paoloricciuti/sprinkle-js/issues/3"));d.batch=D,d.bindChildren=H,d.bindChildrens=ct,d.bindClass=et,d.bindClasses=nt,d.bindDom=M,d.bindInnerHTML=tt,d.bindInputValue=st,d.bindStyle=it,d.bindTextContent=q,d.createComputed=X,d.createCssVariable=G,d.createEffect=b,d.createRef=z,d.createStored=Y,d.createVariable=w,d.html=ot,d.setup=Z,d.untrack=K,Object.defineProperties(d,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
